<!DOCTYPE html>
<html>
	<head>
		<title>Universal Comments</title>
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

		<!-- Latest compiled and minified JavaScript -->
		<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

		<style>
			body {
				background-image: url("crossword.png");
			}
			
			#url{
				margin:10px 0 10px 0;
			}

			#comments .comment:nth-of-type(odd){
				background-color:#63ADD0;
			}

			#comments .comment:nth-of-type(even){
				background-color:#FFA640;
				background-color:#FF8990;
				background-color:#FF8900;
			}

			.comment {
				margin: 10px 0 10px 0;
				padding: 10px;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<div class="row">
			  <div class="col-md-4"></div>
			  <div class="col-md-4" style="text-align:center;">
			  	<input id="url" type="text" class="form-control" placeholder="Enter URL" value="http://www.teslamotors.com/blog/tesla-adds-titanium-underbody-shield-and-aluminum-deflector-plates-model-s">
				<button id="getComments" type="button" class="btn btn-primary btn-block">Get Comments</button>
			  </div>
			  <div class="col-md-4"></div>
			</div>

			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-8">
					<div id="comments"></div>
				</div>
				<div class="col-md-2"></div>
			</div>
		</div>
	</body>

	<script type="text/javascript">
	var url = "http://www.teslamotors.com/blog/tesla-adds-titanium-underbody-shield-and-aluminum-deflector-plates-model-s"
	var comments = [];
	var articleIds = [];

	function getRedditArticleIds(url){
		$.get(
		    "http://www.reddit.com/submit.json?url=" + url,
		    {},
		    function(data) {
		    	//If length is undefined, there are multiple articles that match the url
		    	if (data.length === undefined){
		    		//Loop through all relevant reddit posts
			       for(var i = 0; i < data.data.children.length;i++){
			           var article = data.data.children[i].data;
			           if (isGoodArticle(article)){
			           	articleIds.push(article.id);
			           	getRedditComments(article.id);
			           }
			       }
		    	} else{
		    		//only 1 article matching the url
		    		var article = data[0].data.children[0].data
		    		if (isGoodArticle(article)){
		    			articleIds.push(article.id);
		    			getRedditComments(article.id);
		    		}
		    	}
		    	
		    }
		);
	}

	function isGoodArticle(article){
		if (article.num_comments > 0 && article.score > 20){
			return true;
		}
		return false;
	}

	function getRedditComments(id){
		$.get(
			"http://www.reddit.com/r/all/comments/" + id + ".json",
		    {},
		    function(data) {
		       for(var i = 0; i < data[1].data.children.length; i++ ){
		       	comments.push(data[1].data.children[i]);
		       	$("#comments").append("<div class='comment'>" + data[1].data.children[i].data.body + "</div>");
		       }
		    }
		);
	}

	

	$(document).ready(function(){	
		$("#getComments").click(function(){
			$("#comments").html("");
			url = $("#url").val();
			getRedditArticleIds(url);
		})
		// getRedditArticleIds(url);
		// getRedditComments("21m4hj");
	});
	
	</script>
</html>